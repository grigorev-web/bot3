---
title: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π —Å LLM –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
description: –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥—É–ª–µ–π –¥–ª—è —É–º–Ω–æ–π –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
category: architecture
tags: [modules, llm, classifier, router, architecture]
last_updated: 2024-01-01
author: Telegram Bot Team
version: 2.0.0
related_files: [src/modules/**/*.js, src/config/llm.js]
---

# –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥—É–ª–µ–π –∏ —Å–µ—Ä–≤–∏—Å–æ–≤

## üèóÔ∏è –û–±—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:

- **`src/modules/`** - –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –º–æ–¥—É–ª–∏ –±–æ—Ç–∞ (—Ä–æ—É—Ç–µ—Ä, –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä)
- **`src/services/`** - –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (API, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)
- **`src/handlers/`** - –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π Telegram
- **`src/config/`** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
- **`src/app/`** - –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## üì¶ –ú–æ–¥—É–ª–∏ (src/modules/)

–ú–æ–¥—É–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É –±–æ—Ç–∞:

### Router Module (`src/modules/router/`)
- **SmartRouter** - –£–º–Ω—ã–π —Ä–æ—É—Ç–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π —Å LLM –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
- **Responsibility**: –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- **Features**: LLM –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è + –ø–∞—Ç—Ç–µ—Ä–Ω-–º–∞—Ç—á–∏–Ω–≥ + fallback

### Classifier Module (`src/modules/classifier/`)
- **MessageClassifier** - –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º LLM
- **Responsibility**: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
- **Features**: –ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ + LLM –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è

## üîå –°–µ—Ä–≤–∏—Å—ã (src/services/)

–°–µ—Ä–≤–∏—Å—ã –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏:

### LLM Service (`src/services/llm/`)
- **LLMService** - –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM API —á–µ—Ä–µ–∑ ProxyAPI
- **Responsibility**: –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –≤–Ω–µ—à–Ω–∏–º–∏ LLM API
- **Features**: ProxyAPI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è + fallback + –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

## üîÑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

### 1. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **–ú–æ–¥—É–ª–∏** = –õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞
- **–°–µ—Ä–≤–∏—Å—ã** = –í–Ω–µ—à–Ω–∏–µ API –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **Handlers** = –û–±—Ä–∞–±–æ—Ç–∫–∞ Telegram —Å–æ–æ–±—â–µ–Ω–∏–π

### 2. Dependency Injection
- –ú–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ dependency injection
- –°–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –º–æ–¥—É–ª–µ–π
- –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–µ–≤

### 3. Fallback —Å–∏—Å—Ç–µ–º–∞
- –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ fallback
- Graceful degradation –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –†–∞–±–æ—Ç–∞ –±–æ—Ç–∞ –¥–∞–∂–µ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

## üìä –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö

```
Telegram Message ‚Üí Handler ‚Üí Router ‚Üí Classifier ‚Üí LLM Service ‚Üí ProxyAPI
                                    ‚Üì
                              Pattern Matching (fallback)
                                    ‚Üì
                              Simple Router (fallback)
                                    ‚Üì
                              Stub Router (last resort)
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### LLM Service Configuration
```javascript
// src/config/llm.js
const llmConfig = {
  defaultProvider: 'proxyApi',
  providers: {
    proxyApi: {
      apiUrl: process.env.PROXYAPI_URL,
      model: process.env.PROXYAPI_MODEL,
      // ... –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    }
  }
};
```

### Environment Variables
```bash
# LLM Provider
LLM_PROVIDER=proxyApi

# ProxyAPI Configuration
PROXYAPI_KEY=your_proxyapi_key_here
PROXYAPI_URL=https://api.proxyapi.com/v1
PROXYAPI_MODEL=gpt-3.5-turbo
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
```javascript
// –í TextMessageHandler
const { SmartRouter } = require('../modules');
const llmConfig = require('../config/llm');

this.router = new SmartRouter(llmConfig, options);
await this.router.initialize();
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤
```javascript
// –í –º–æ–¥—É–ª—è—Ö
const LLMService = require('../../services/llm/llmService');
const llmService = new LLMService(config);
```

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–æ–¥—É–ª–µ–π
1. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –≤ `src/modules/`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –ª–æ–≥–∏–∫—É
3. –î–æ–±–∞–≤–∏—Ç—å –≤ `src/modules/index.js`
4. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
1. –°–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –≤ `src/services/`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å API –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
3. –î–æ–±–∞–≤–∏—Ç—å –≤ `src/services/index.js`
4. –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ**: –õ–æ–≥–∏–∫–∞ –±–æ—Ç–∞ –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
2. **–õ–µ–≥–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ú–æ–¥—É–ª–∏ –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
3. **–ü—Ä–æ—Å—Ç–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ**: –ù–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏
4. **Fallback —Å–∏—Å—Ç–µ–º–∞**: –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω–µ—à–Ω–∏—Ö API
5. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º–æ—Å—Ç—å**: –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ LLM API –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∞ –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
