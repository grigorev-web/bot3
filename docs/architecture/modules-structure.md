---
title: Структура модулей
description: Детальное описание модулей проекта и их взаимодействия
category: architecture
tags: [модули, роутер, llm, обработчики, структура]
last_updated: 2024-01-01
author: Разработчик
version: 4.0.0
related_files: [src/modules/index.js, src/modules/router/router.js, src/handlers/textMessageHandler.js]
---

# Структура модулей

## 🏗️ Общая организация

Модули проекта организованы по принципу разделения ответственности:

```
src/modules/
├── index.js           # Экспорт всех модулей
├── router/            # Модуль роутинга с LLM
│   ├── index.js       # Экспорт роутера
│   └── router.js      # Основная логика LLM роутера
└── classifier/        # Классификатор (зарезервирован)
    └── index.js       # Экспорт классификатора
```

## 🔧 Основные модули

### 1. LLM Router Module

#### Назначение
Простая обработка сообщений через LLM без сложной логики.

#### Структура
```javascript
// src/modules/router/router.js
class SimpleRouter {
  constructor()           // Инициализация
  processText(text)      // Обработка текста через LLM
  createLLMService()     // Создание LLM сервиса
}
```

#### Принцип работы
1. **Получает текст** от обработчика сообщений
2. **Создает LLM сервис** (ленивая загрузка)
3. **Делает запрос** к LLM через ProxyAPI
4. **Возвращает ответ** от LLM пользователю

#### Пример использования
```javascript
const router = new SimpleRouter();

// Обработка текста через LLM
const response = await router.processText('Привет, как дела?');
console.log(response); // Ответ от LLM
```

### 2. Classifier Module (Зарезервирован)

#### Назначение
Зарезервирован для будущей функциональности классификации сообщений.

#### Текущий статус
- Модуль создан, но не используется
- Готов для интеграции в будущем
- Не влияет на текущую функциональность

## 🔄 Взаимодействие модулей

### Схема взаимодействия

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ TextMessage     │    │ SimpleRouter    │    │ LLM Service     │
│ Handler         │───►│                 │───►│ (ProxyAPI)      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│ Response        │    │ LLM Response    │    │ External        │
│ Sending         │    │ Processing      │    │ LLM API         │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### Детальный поток

1. **TextMessageHandler** получает сообщение
2. **Создает SimpleRouter** (ленивая загрузка)
3. **Роутер создает LLM сервис** (ленивая загрузка)
4. **Делает запрос к LLM** через ProxyAPI
5. **Получает ответ** от LLM
6. **Ответ отправляется** пользователю

## 📋 Интерфейсы модулей

### Router Interface
```javascript
/**
 * @interface Router
 * @description Базовый интерфейс для LLM роутеров
 */
class Router {
  /**
   * Обрабатывает текстовое сообщение через LLM
   * @param {string} text - Текст для обработки
   * @returns {Promise<string>} Ответ от LLM
   */
  processText(text) {}
  
  /**
   * Проверяет готовность роутера
   * @returns {boolean} true если готов
   */
  isReady() {}
  
  /**
   * Получает информацию о роутере
   * @returns {Object} Информация о модуле
   */
  getInfo() {}
}
```

## 🚀 Расширение модулей

### Создание нового модуля

1. **Создайте папку** в `src/modules/`
2. **Создайте index.js** для экспорта
3. **Добавьте в** `src/modules/index.js`
4. **Обновите документацию**

#### Пример структуры нового модуля
```
src/modules/newModule/
├── index.js           # Экспорт модуля
├── newModule.js       # Основная логика
└── README.md          # Документация модуля
```

## 🔍 Мониторинг и отладка

### Логирование модулей
- **Router**: Логирует создание LLM сервиса, запросы к LLM
- **Handler**: Логирует получение сообщений и вызовы роутера
- **LLM Service**: Логирует взаимодействие с внешними API

### Метрики производительности
- **Время обработки** текста через LLM
- **Время отклика** LLM API
- **Статистика использования** LLM
- **Ошибки LLM интеграции**

### Отладка
```javascript
// Получение информации о роутере
const routerInfo = router.getInfo();
console.log('Router info:', routerInfo);

// Проверка готовности
const isReady = router.isReady();
console.log('Router ready:', isReady);

// Проверка LLM сервиса
const hasLLM = router.llmService !== null;
console.log('Has LLM service:', hasLLM);
```

## 📊 Статистика и аналитика

### Сбор данных
- Количество обработанных сообщений через LLM
- Время отклика LLM API
- Ошибки и исключения LLM
- Использование ProxyAPI

### Визуализация
- Графики времени отклика LLM
- Статистика ошибок LLM
- Мониторинг ProxyAPI
- Отчеты по производительности

## 🔒 Безопасность модулей

### Валидация входных данных
- Проверка типов параметров
- Санитизация текста перед отправкой в LLM
- Ограничение длины сообщений
- Защита от инъекций

### Безопасность LLM API
- Безопасное хранение API ключей
- Валидация ответов от LLM
- Ограничение частоты запросов
- Логирование всех LLM взаимодействий

## 🚀 Планы развития

### Краткосрочные (v4.1)
- [ ] Улучшение интеграции с LLM API
- [ ] Расширение конфигурации ProxyAPI
- [ ] Улучшение fallback ответов

### Среднесрочные (v4.2)
- [ ] Кэширование LLM ответов
- [ ] Метрики производительности LLM
- [ ] Система плагинов для LLM

### Долгосрочные (v5.0)
- [ ] Мультимодальные LLM (изображения, аудио)
- [ ] Персонализация LLM ответов
- [ ] Интеграция с векторными базами данных

## 🔌 LLM интеграция

### Поддерживаемые провайдеры
- **OpenAI** - GPT-4, GPT-3.5-turbo
- **Anthropic** - Claude Sonnet, Claude Haiku
- **Gemini** - Gemini Pro, Gemini Flash
- **DeepSeek** - DeepSeek Chat

### ProxyAPI преимущества
- Единый API для всех провайдеров
- Европейские серверы для стабильности
- Автоматическая маршрутизация по моделям
- Управление через единый интерфейс

---

*Для детальной информации о конкретных модулях см. соответствующие файлы в `src/modules/`.*
